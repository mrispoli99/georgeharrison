<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mafoo George Harrison Guessing Game</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,700;1,400&family=DM+Mono:wght@400;500&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">
<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  :root {
    --cream: #f5f0e8;
    --dark: #1a1208;
    --gold: #c9a84c;
    --red: #c0392b;
    --green: #27ae60;
    --mid: #6b5c3e;
    --light-mid: #d4c8b0;
  }

  body {
    background: var(--cream);
    color: var(--dark);
    font-family: 'DM Sans', sans-serif;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 20px;
    overflow-x: hidden;
  }

  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background:
      radial-gradient(ellipse 80% 60% at 20% 10%, rgba(201,168,76,0.12) 0%, transparent 60%),
      radial-gradient(ellipse 60% 80% at 85% 90%, rgba(201,168,76,0.08) 0%, transparent 60%);
    pointer-events: none;
  }

  .wrapper {
    width: 100%;
    max-width: 560px;
    position: relative;
  }

  header {
    text-align: center;
    margin-bottom: 36px;
  }

  .logo {
    font-family: 'Playfair Display', serif;
    font-size: clamp(2.4rem, 6vw, 3.4rem);
    font-weight: 700;
    letter-spacing: -1px;
    line-height: 1;
    color: var(--dark);
  }

  .logo em {
    font-style: italic;
    font-weight: 400;
    color: var(--gold);
  }

  .tagline {
    font-family: 'DM Mono', monospace;
    font-size: 0.72rem;
    letter-spacing: 0.18em;
    text-transform: uppercase;
    color: var(--mid);
    margin-top: 8px;
  }

  /* LIVES */
  .lives {
    display: flex;
    justify-content: center;
    gap: 10px;
    margin-bottom: 28px;
  }

  .life {
    width: 34px;
    height: 34px;
    border-radius: 50%;
    border: 2px solid var(--dark);
    background: var(--dark);
    transition: background 0.3s, transform 0.2s;
    position: relative;
    overflow: hidden;
  }

  .life::after {
    content: 'â™ª';
    position: absolute;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 16px;
    color: var(--cream);
    line-height: 34px;
    text-align: center;
  }

  .life.used {
    background: transparent;
    border-color: var(--light-mid);
  }

  .life.used::after {
    color: var(--light-mid);
  }

  /* WAVEFORM / PLAYER */
  .player-card {
    background: var(--dark);
    border-radius: 16px;
    padding: 28px 28px 22px;
    margin-bottom: 20px;
    position: relative;
    overflow: hidden;
  }

  .player-card::before {
    content: '';
    position: absolute;
    top: -40px; right: -40px;
    width: 160px; height: 160px;
    border-radius: 50%;
    background: rgba(201,168,76,0.07);
    pointer-events: none;
  }

  .round-label {
    font-family: 'DM Mono', monospace;
    font-size: 0.65rem;
    letter-spacing: 0.2em;
    text-transform: uppercase;
    color: var(--gold);
    margin-bottom: 16px;
  }

  /* Waveform bars */
  .waveform {
    display: flex;
    align-items: center;
    gap: 3px;
    height: 60px;
    margin-bottom: 20px;
  }

  .bar {
    flex: 1;
    border-radius: 2px;
    transition: height 0.15s ease, background 0.3s;
    min-width: 3px;
  }

  .bar.played {
    background: var(--gold);
  }

  .bar.unplayed {
    background: rgba(255,255,255,0.15);
  }

  /* Progress / time info */
  .time-info {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 16px;
  }

  .time-display {
    font-family: 'DM Mono', monospace;
    font-size: 0.8rem;
    color: rgba(255,255,255,0.5);
  }

  .reveal-label {
    font-family: 'DM Mono', monospace;
    font-size: 0.7rem;
    color: var(--gold);
    letter-spacing: 0.1em;
  }

  /* Play button */
  .play-btn {
    width: 100%;
    background: var(--gold);
    border: none;
    border-radius: 10px;
    padding: 14px;
    font-family: 'DM Mono', monospace;
    font-size: 0.85rem;
    font-weight: 500;
    letter-spacing: 0.1em;
    color: var(--dark);
    cursor: pointer;
    transition: opacity 0.2s, transform 0.15s;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
  }

  .play-btn:hover { opacity: 0.88; transform: translateY(-1px); }
  .play-btn:active { transform: translateY(0); }
  .play-btn:disabled { opacity: 0.4; cursor: not-allowed; transform: none; }

  .play-icon { font-size: 1.1rem; }

  /* GUESSES */
  .guesses-section { margin-bottom: 20px; }

  .guess-slots {
    display: flex;
    flex-direction: column;
    gap: 8px;
    margin-bottom: 14px;
  }

  .guess-slot {
    border-radius: 10px;
    padding: 12px 16px;
    font-family: 'DM Mono', monospace;
    font-size: 0.82rem;
    min-height: 46px;
    display: flex;
    align-items: center;
    transition: all 0.3s;
  }

  .guess-slot.empty {
    border: 2px dashed var(--light-mid);
    color: var(--light-mid);
  }

  .guess-slot.empty.active {
    border-color: var(--gold);
    background: rgba(201,168,76,0.05);
  }

  .guess-slot.wrong {
    border: 2px solid var(--red);
    background: rgba(192,57,43,0.07);
    color: var(--red);
  }

  .guess-slot.skipped {
    border: 2px solid var(--mid);
    background: rgba(107,92,62,0.07);
    color: var(--mid);
    font-style: italic;
  }

  .guess-slot.correct {
    border: 2px solid var(--green);
    background: rgba(39,174,96,0.1);
    color: var(--green);
    font-weight: 500;
  }

  .guess-slot .icon {
    margin-right: 10px;
    font-size: 1rem;
    flex-shrink: 0;
  }

  /* INPUT ROW */
  .input-row {
    display: flex;
    gap: 8px;
  }

  .song-input {
    flex: 1;
    border: 2px solid var(--dark);
    border-radius: 10px;
    padding: 12px 16px;
    font-family: 'DM Sans', sans-serif;
    font-size: 0.9rem;
    background: white;
    color: var(--dark);
    outline: none;
    transition: border-color 0.2s;
  }

  .song-input:focus { border-color: var(--gold); }
  .song-input::placeholder { color: var(--light-mid); }
  .song-input:disabled { opacity: 0.5; }

  /* Autocomplete */
  .autocomplete-wrap { position: relative; flex: 1; }

  .suggestions {
    position: absolute;
    bottom: calc(100% + 6px);
    left: 0; right: 0;
    background: white;
    border: 2px solid var(--dark);
    border-radius: 10px;
    overflow: hidden;
    z-index: 100;
    box-shadow: 0 8px 24px rgba(0,0,0,0.12);
    max-height: 220px;
    overflow-y: auto;
  }

  .suggestion-item {
    padding: 11px 16px;
    cursor: pointer;
    font-size: 0.88rem;
    font-family: 'DM Sans', sans-serif;
    border-bottom: 1px solid var(--cream);
    transition: background 0.15s;
  }

  .suggestion-item:last-child { border-bottom: none; }
  .suggestion-item:hover, .suggestion-item.highlighted { background: var(--cream); }

  .guess-btn, .skip-btn {
    border-radius: 10px;
    padding: 12px 18px;
    font-family: 'DM Mono', monospace;
    font-size: 0.8rem;
    font-weight: 500;
    cursor: pointer;
    border: 2px solid var(--dark);
    transition: all 0.2s;
    white-space: nowrap;
  }

  .guess-btn {
    background: var(--dark);
    color: var(--cream);
  }

  .guess-btn:hover { opacity: 0.85; }
  .guess-btn:disabled { opacity: 0.35; cursor: not-allowed; }

  .skip-btn {
    background: transparent;
    color: var(--mid);
    border-color: var(--light-mid);
  }

  .skip-btn:hover { border-color: var(--mid); color: var(--dark); }
  .skip-btn:disabled { opacity: 0.35; cursor: not-allowed; }

  /* RESULT OVERLAY */
  .result-overlay {
    display: none;
    background: var(--dark);
    border-radius: 16px;
    padding: 32px 28px;
    text-align: center;
    animation: slideUp 0.4s cubic-bezier(0.34,1.56,0.64,1);
  }

  .result-overlay.show { display: block; }

  @keyframes slideUp {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .result-emoji { font-size: 3rem; margin-bottom: 12px; }

  .result-title {
    font-family: 'Playfair Display', serif;
    font-size: 1.5rem;
    color: var(--cream);
    margin-bottom: 6px;
  }

  .result-song {
    font-family: 'DM Mono', monospace;
    font-size: 0.8rem;
    color: var(--gold);
    letter-spacing: 0.1em;
    margin-bottom: 6px;
  }

  .result-album {
    font-size: 0.8rem;
    color: rgba(255,255,255,0.4);
    margin-bottom: 24px;
  }

  .next-btn {
    background: var(--gold);
    border: none;
    border-radius: 10px;
    padding: 13px 32px;
    font-family: 'DM Mono', monospace;
    font-size: 0.85rem;
    font-weight: 500;
    color: var(--dark);
    cursor: pointer;
    transition: opacity 0.2s;
  }

  .next-btn:hover { opacity: 0.85; }

  /* Score */
  .score-bar {
    text-align: center;
    margin-bottom: 20px;
    font-family: 'DM Mono', monospace;
    font-size: 0.72rem;
    color: var(--mid);
    letter-spacing: 0.1em;
  }

  .score-bar span { color: var(--dark); font-weight: 500; }

  /* Playing animation */
  @keyframes pulse {
    0%, 100% { transform: scaleY(1); }
    50% { transform: scaleY(1.6); }
  }

  .bar.playing {
    background: var(--gold) !important;
    animation: pulse 0.5s ease-in-out infinite;
  }

  /* Album art + player layout */
  .player-top {
    display: flex;
    gap: 16px;
    align-items: flex-start;
    margin-bottom: 4px;
  }

  #album-art {
    width: 72px;
    height: 72px;
    border-radius: 8px;
    object-fit: cover;
    flex-shrink: 0;
    opacity: 0;
    filter: blur(12px);
    transition: opacity 0.5s, filter 0.5s;
    border: 2px solid rgba(255,255,255,0.08);
  }

  #album-art.loaded {
    opacity: 1;
    filter: blur(0);
  }

  .player-main {
    flex: 1;
    min-width: 0;
  }

</style>
</head>
<body>

<div class="wrapper">
  <header>
    <div class="logo">Mafoo <em>George</em></div>
    <div class="tagline">George Harrison Guessing Game</div>
  </header>

  <div class="score-bar">Score: <span id="score">0</span> &nbsp;|&nbsp; Song #<span id="round-num">1</span></div>

  <div class="lives" id="lives"></div>

  <div class="player-card" id="player-card">
    <div class="player-top">
      <img id="album-art" src="" alt="Album art" style="display:none" />
      <div class="player-main">
        <div class="round-label" id="round-label">GUESS 1 OF 5 â€” LISTEN CAREFULLY</div>
        <div class="waveform" id="waveform"></div>
        <div class="time-info">
          <span class="time-display" id="time-display">0.0s</span>
          <span class="reveal-label" id="reveal-label">â–¶ 1 second</span>
        </div>
      </div>
    </div>
    <button class="play-btn" id="play-btn">
      <span class="play-icon">â–¶</span>
      <span id="play-btn-text">Play Clip</span>
    </button>
  </div>

  <div class="guesses-section">
    <div class="guess-slots" id="guess-slots"></div>
    <div class="input-row">
      <div class="autocomplete-wrap">
        <input type="text" class="song-input" id="song-input" placeholder="Name that tuneâ€¦" autocomplete="off" />
        <div class="suggestions" id="suggestions" style="display:none"></div>
      </div>
      <button class="skip-btn" id="skip-btn">Skip</button>
      <button class="guess-btn" id="guess-btn">Guess</button>
    </div>
  </div>

  <div class="result-overlay" id="result-overlay">
    <div class="result-emoji" id="result-emoji">ðŸŽ‰</div>
    <div class="result-title" id="result-title">You got it!</div>
    <div class="result-song" id="result-song"></div>
    <div class="result-album" id="result-album"></div>
    <button class="next-btn" id="next-btn">Next Song â†’</button>
  </div>
</div>

<script>
// â”€â”€â”€ SONG DATA â€” George Harrison Solo Catalog â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const SONGS = [
  // Wonderwall Music (1968)
  { title: "Microbes",                          album: "Wonderwall Music (1968)",        itunesQuery: "Microbes George Harrison" },
  { title: "Dream Scene",                       album: "Wonderwall Music (1968)",        itunesQuery: "Dream Scene George Harrison" },
  { title: "Party Seacombe",                    album: "Wonderwall Music (1968)",        itunesQuery: "Party Seacombe George Harrison" },
  { title: "Love Scene",                        album: "Wonderwall Music (1968)",        itunesQuery: "Love Scene George Harrison Wonderwall" },
  // All Things Must Pass (1970)
  { title: "I'd Have You Anytime",              album: "All Things Must Pass (1970)",    itunesQuery: "I'd Have You Anytime George Harrison" },
  { title: "My Sweet Lord",                     album: "All Things Must Pass (1970)",    itunesQuery: "My Sweet Lord George Harrison" },
  { title: "Wah-Wah",                           album: "All Things Must Pass (1970)",    itunesQuery: "Wah-Wah George Harrison" },
  { title: "Isn't It a Pity",                   album: "All Things Must Pass (1970)",    itunesQuery: "Isn't It a Pity George Harrison" },
  { title: "What Is Life",                      album: "All Things Must Pass (1970)",    itunesQuery: "What Is Life George Harrison" },
  { title: "If Not for You",                    album: "All Things Must Pass (1970)",    itunesQuery: "If Not for You George Harrison" },
  { title: "Behind That Locked Door",           album: "All Things Must Pass (1970)",    itunesQuery: "Behind That Locked Door George Harrison" },
  { title: "Let It Down",                       album: "All Things Must Pass (1970)",    itunesQuery: "Let It Down George Harrison" },
  { title: "Run of the Mill",                   album: "All Things Must Pass (1970)",    itunesQuery: "Run of the Mill George Harrison" },
  { title: "Beware of Darkness",                album: "All Things Must Pass (1970)",    itunesQuery: "Beware of Darkness George Harrison" },
  { title: "Apple Scruffs",                     album: "All Things Must Pass (1970)",    itunesQuery: "Apple Scruffs George Harrison" },
  { title: "Ballad of Sir Frankie Crisp",       album: "All Things Must Pass (1970)",    itunesQuery: "Ballad of Sir Frankie Crisp George Harrison" },
  { title: "Awaiting on You All",               album: "All Things Must Pass (1970)",    itunesQuery: "Awaiting on You All George Harrison" },
  { title: "All Things Must Pass",              album: "All Things Must Pass (1970)",    itunesQuery: "All Things Must Pass George Harrison" },
  { title: "I Dig Love",                        album: "All Things Must Pass (1970)",    itunesQuery: "I Dig Love George Harrison" },
  { title: "Art of Dying",                      album: "All Things Must Pass (1970)",    itunesQuery: "Art of Dying George Harrison" },
  { title: "Hear Me Lord",                      album: "All Things Must Pass (1970)",    itunesQuery: "Hear Me Lord George Harrison" },
  // The Concert for Bangladesh (1971)
  { title: "Wah-Wah (Live)",                    album: "The Concert for Bangladesh (1971)", itunesQuery: "Wah-Wah live George Harrison Bangladesh" },
  { title: "Something (Live)",                  album: "The Concert for Bangladesh (1971)", itunesQuery: "Something live George Harrison Bangladesh" },
  { title: "Here Comes the Sun (Live)",         album: "The Concert for Bangladesh (1971)", itunesQuery: "Here Comes the Sun live George Harrison Bangladesh" },
  // Living in the Material World (1973)
  { title: "Give Me Love (Give Me Peace on Earth)", album: "Living in the Material World (1973)", itunesQuery: "Give Me Love Give Me Peace on Earth George Harrison" },
  { title: "Sue Me, Sue You Blues",             album: "Living in the Material World (1973)", itunesQuery: "Sue Me Sue You Blues George Harrison" },
  { title: "The Light That Has Lighted the World", album: "Living in the Material World (1973)", itunesQuery: "The Light That Has Lighted the World George Harrison" },
  { title: "Don't Let Me Wait Too Long",        album: "Living in the Material World (1973)", itunesQuery: "Don't Let Me Wait Too Long George Harrison" },
  { title: "Who Can See It",                    album: "Living in the Material World (1973)", itunesQuery: "Who Can See It George Harrison" },
  { title: "Living in the Material World",      album: "Living in the Material World (1973)", itunesQuery: "Living in the Material World George Harrison" },
  { title: "The Lord Loves the One",            album: "Living in the Material World (1973)", itunesQuery: "The Lord Loves the One George Harrison" },
  { title: "Be Here Now",                       album: "Living in the Material World (1973)", itunesQuery: "Be Here Now George Harrison" },
  { title: "Try Some, Buy Some",                album: "Living in the Material World (1973)", itunesQuery: "Try Some Buy Some George Harrison" },
  { title: "The Day the World Gets 'Round",     album: "Living in the Material World (1973)", itunesQuery: "The Day the World Gets Round George Harrison" },
  { title: "That Is All",                       album: "Living in the Material World (1973)", itunesQuery: "That Is All George Harrison" },
  // Dark Horse (1974)
  { title: "Hari's on Tour (Express)",          album: "Dark Horse (1974)",              itunesQuery: "Hari's on Tour Express George Harrison" },
  { title: "Simply Shady",                      album: "Dark Horse (1974)",              itunesQuery: "Simply Shady George Harrison" },
  { title: "So Sad",                            album: "Dark Horse (1974)",              itunesQuery: "So Sad George Harrison" },
  { title: "Bye Bye, Love",                     album: "Dark Horse (1974)",              itunesQuery: "Bye Bye Love George Harrison" },
  { title: "Maya Love",                         album: "Dark Horse (1974)",              itunesQuery: "Maya Love George Harrison" },
  { title: "Ding Dong, Ding Dong",              album: "Dark Horse (1974)",              itunesQuery: "Ding Dong Ding Dong George Harrison" },
  { title: "Dark Horse",                        album: "Dark Horse (1974)",              itunesQuery: "Dark Horse George Harrison" },
  { title: "Far East Man",                      album: "Dark Horse (1974)",              itunesQuery: "Far East Man George Harrison" },
  { title: "It Is 'He' (Jai Sri Krishna)",      album: "Dark Horse (1974)",              itunesQuery: "It Is He Jai Sri Krishna George Harrison" },
  // Extra Texture (1975)
  { title: "You",                               album: "Extra Texture (1975)",           itunesQuery: "You George Harrison Extra Texture" },
  { title: "The Answer's at the End",           album: "Extra Texture (1975)",           itunesQuery: "The Answer's at the End George Harrison" },
  { title: "This Guitar (Can't Keep from Crying)", album: "Extra Texture (1975)",        itunesQuery: "This Guitar Can't Keep from Crying George Harrison" },
  { title: "Ooh Baby (You Know That I Love You)", album: "Extra Texture (1975)",         itunesQuery: "Ooh Baby You Know That I Love You George Harrison" },
  { title: "World of Stone",                    album: "Extra Texture (1975)",           itunesQuery: "World of Stone George Harrison" },
  { title: "A Bit More of You",                 album: "Extra Texture (1975)",           itunesQuery: "A Bit More of You George Harrison" },
  { title: "Can't Stop Thinking About You",     album: "Extra Texture (1975)",           itunesQuery: "Can't Stop Thinking About You George Harrison" },
  { title: "Tired of Midnight Blue",            album: "Extra Texture (1975)",           itunesQuery: "Tired of Midnight Blue George Harrison" },
  { title: "Grey Cloudy Lies",                  album: "Extra Texture (1975)",           itunesQuery: "Grey Cloudy Lies George Harrison" },
  { title: "His Name Is Legs (Ladies & Gentlemen)", album: "Extra Texture (1975)",       itunesQuery: "His Name Is Legs George Harrison" },
  // Thirty Three & 1/3 (1976)
  { title: "Woman Don't You Cry for Me",        album: "Thirty Three & 1/3 (1976)",      itunesQuery: "Woman Don't You Cry for Me George Harrison" },
  { title: "Dear One",                          album: "Thirty Three & 1/3 (1976)",      itunesQuery: "Dear One George Harrison" },
  { title: "Beautiful Girl",                    album: "Thirty Three & 1/3 (1976)",      itunesQuery: "Beautiful Girl George Harrison" },
  { title: "This Song",                         album: "Thirty Three & 1/3 (1976)",      itunesQuery: "This Song George Harrison" },
  { title: "See Yourself",                      album: "Thirty Three & 1/3 (1976)",      itunesQuery: "See Yourself George Harrison" },
  { title: "It's What You Value",               album: "Thirty Three & 1/3 (1976)",      itunesQuery: "It's What You Value George Harrison" },
  { title: "True Love",                         album: "Thirty Three & 1/3 (1976)",      itunesQuery: "True Love George Harrison" },
  { title: "Pure Smokey",                       album: "Thirty Three & 1/3 (1976)",      itunesQuery: "Pure Smokey George Harrison" },
  { title: "Crackerbox Palace",                 album: "Thirty Three & 1/3 (1976)",      itunesQuery: "Crackerbox Palace George Harrison" },
  { title: "Learning How to Love You",          album: "Thirty Three & 1/3 (1976)",      itunesQuery: "Learning How to Love You George Harrison" },
  // George Harrison (1979)
  { title: "Love Comes to Everyone",            album: "George Harrison (1979)",         itunesQuery: "Love Comes to Everyone George Harrison" },
  { title: "Not Guilty",                        album: "George Harrison (1979)",         itunesQuery: "Not Guilty George Harrison" },
  { title: "Here Comes the Moon",               album: "George Harrison (1979)",         itunesQuery: "Here Comes the Moon George Harrison" },
  { title: "Soft-Hearted Hana",                 album: "George Harrison (1979)",         itunesQuery: "Soft-Hearted Hana George Harrison" },
  { title: "Blow Away",                         album: "George Harrison (1979)",         itunesQuery: "Blow Away George Harrison" },
  { title: "Faster",                            album: "George Harrison (1979)",         itunesQuery: "Faster George Harrison" },
  { title: "Dark Sweet Lady",                   album: "George Harrison (1979)",         itunesQuery: "Dark Sweet Lady George Harrison" },
  { title: "Your Love Is Forever",              album: "George Harrison (1979)",         itunesQuery: "Your Love Is Forever George Harrison" },
  { title: "Mystical One",                      album: "George Harrison (1979)",         itunesQuery: "Mystical One George Harrison" },
  { title: "If You Believe",                    album: "George Harrison (1979)",         itunesQuery: "If You Believe George Harrison" },
  // Somewhere in England (1981)
  { title: "Blood from a Clone",                album: "Somewhere in England (1981)",    itunesQuery: "Blood from a Clone George Harrison" },
  { title: "Unconsciousness Rules",             album: "Somewhere in England (1981)",    itunesQuery: "Unconsciousness Rules George Harrison" },
  { title: "Life Itself",                       album: "Somewhere in England (1981)",    itunesQuery: "Life Itself George Harrison" },
  { title: "All Those Years Ago",               album: "Somewhere in England (1981)",    itunesQuery: "All Those Years Ago George Harrison" },
  { title: "Baltimore Oriole",                  album: "Somewhere in England (1981)",    itunesQuery: "Baltimore Oriole George Harrison" },
  { title: "Teardrops",                         album: "Somewhere in England (1981)",    itunesQuery: "Teardrops George Harrison" },
  { title: "That Which I Have Lost",            album: "Somewhere in England (1981)",    itunesQuery: "That Which I Have Lost George Harrison" },
  { title: "Writing's on the Wall",             album: "Somewhere in England (1981)",    itunesQuery: "Writing's on the Wall George Harrison" },
  { title: "Hong Kong Blues",                   album: "Somewhere in England (1981)",    itunesQuery: "Hong Kong Blues George Harrison" },
  { title: "Save the World",                    album: "Somewhere in England (1981)",    itunesQuery: "Save the World George Harrison" },
  // Gone Troppo (1982)
  { title: "Wake Up My Love",                   album: "Gone Troppo (1982)",             itunesQuery: "Wake Up My Love George Harrison" },
  { title: "That's the Way It Goes",            album: "Gone Troppo (1982)",             itunesQuery: "That's the Way It Goes George Harrison" },
  { title: "I Really Love You",                 album: "Gone Troppo (1982)",             itunesQuery: "I Really Love You George Harrison" },
  { title: "Greece",                            album: "Gone Troppo (1982)",             itunesQuery: "Greece George Harrison Gone Troppo" },
  { title: "Gone Troppo",                       album: "Gone Troppo (1982)",             itunesQuery: "Gone Troppo George Harrison" },
  { title: "Mystical One",                      album: "Gone Troppo (1982)",             itunesQuery: "Mystical One George Harrison Gone Troppo" },
  { title: "Unknown Delight",                   album: "Gone Troppo (1982)",             itunesQuery: "Unknown Delight George Harrison" },
  { title: "Baby Don't Run Away",               album: "Gone Troppo (1982)",             itunesQuery: "Baby Don't Run Away George Harrison" },
  { title: "Dream Away",                        album: "Gone Troppo (1982)",             itunesQuery: "Dream Away George Harrison" },
  { title: "Circles",                           album: "Gone Troppo (1982)",             itunesQuery: "Circles George Harrison" },
  // Cloud Nine (1987)
  { title: "Cloud 9",                           album: "Cloud Nine (1987)",              itunesQuery: "Cloud 9 George Harrison" },
  { title: "That's What It Takes",              album: "Cloud Nine (1987)",              itunesQuery: "That's What It Takes George Harrison" },
  { title: "Fish on the Sand",                  album: "Cloud Nine (1987)",              itunesQuery: "Fish on the Sand George Harrison" },
  { title: "Just for Today",                    album: "Cloud Nine (1987)",              itunesQuery: "Just for Today George Harrison" },
  { title: "This Is Love",                      album: "Cloud Nine (1987)",              itunesQuery: "This Is Love George Harrison" },
  { title: "When We Was Fab",                   album: "Cloud Nine (1987)",              itunesQuery: "When We Was Fab George Harrison" },
  { title: "Devil's Radio",                     album: "Cloud Nine (1987)",              itunesQuery: "Devil's Radio George Harrison" },
  { title: "Someplace Else",                    album: "Cloud Nine (1987)",              itunesQuery: "Someplace Else George Harrison" },
  { title: "Wreck of the Hesperus",             album: "Cloud Nine (1987)",              itunesQuery: "Wreck of the Hesperus George Harrison" },
  { title: "Breath Away from Heaven",           album: "Cloud Nine (1987)",              itunesQuery: "Breath Away from Heaven George Harrison" },
  { title: "Got My Mind Set on You",            album: "Cloud Nine (1987)",              itunesQuery: "Got My Mind Set on You George Harrison" },
  // Brainwashed (2002)
  { title: "Any Road",                          album: "Brainwashed (2002)",             itunesQuery: "Any Road George Harrison" },
  { title: "P2 Vatican Blues (Last Saturday Night)", album: "Brainwashed (2002)",        itunesQuery: "P2 Vatican Blues George Harrison" },
  { title: "Pisces Fish",                       album: "Brainwashed (2002)",             itunesQuery: "Pisces Fish George Harrison" },
  { title: "Looking for My Life",               album: "Brainwashed (2002)",             itunesQuery: "Looking for My Life George Harrison" },
  { title: "Rising Sun",                        album: "Brainwashed (2002)",             itunesQuery: "Rising Sun George Harrison Brainwashed" },
  { title: "Stuck Inside a Cloud",              album: "Brainwashed (2002)",             itunesQuery: "Stuck Inside a Cloud George Harrison" },
  { title: "Run So Far",                        album: "Brainwashed (2002)",             itunesQuery: "Run So Far George Harrison" },
  { title: "Never Get Over You",                album: "Brainwashed (2002)",             itunesQuery: "Never Get Over You George Harrison" },
  { title: "Between the Devil and the Deep Blue Sea", album: "Brainwashed (2002)",       itunesQuery: "Between the Devil and the Deep Blue Sea George Harrison" },
  { title: "Rocking Chair in Hawaii",           album: "Brainwashed (2002)",             itunesQuery: "Rocking Chair in Hawaii George Harrison" },
  { title: "Brainwashed",                       album: "Brainwashed (2002)",             itunesQuery: "Brainwashed George Harrison" },
  // Key Singles
  { title: "Bangla Desh",                       album: "Single (1971)",                  itunesQuery: "Bangla Desh George Harrison" },
  { title: "Miss O'Dell",                       album: "Single (1973)",                  itunesQuery: "Miss O'Dell George Harrison" },
  { title: "Ding Dong, Ding Dong",              album: "Single (1974)",                  itunesQuery: "Ding Dong George Harrison single" },
  { title: "You",                               album: "Single (1975)",                  itunesQuery: "You George Harrison 1975 single" },
  { title: "Crackerbox Palace",                 album: "Single (1977)",                  itunesQuery: "Crackerbox Palace George Harrison single" },
  { title: "Blow Away",                         album: "Single (1979)",                  itunesQuery: "Blow Away George Harrison single" },
  { title: "All Those Years Ago",               album: "Single (1981)",                  itunesQuery: "All Those Years Ago George Harrison single" },
  { title: "I Really Love You",                 album: "Single (1982)",                  itunesQuery: "I Really Love You George Harrison single" },
  { title: "I Got My Mind Set on You",          album: "Single (1987)",                  itunesQuery: "Got My Mind Set on You George Harrison" },
  { title: "When We Was Fab",                   album: "Single (1988)",                  itunesQuery: "When We Was Fab George Harrison" },
  // Traveling Wilburys
  { title: "Handle with Care",                  album: "Traveling Wilburys Vol. 1 (1988)", itunesQuery: "Handle with Care Traveling Wilburys" },
  { title: "Dirty World",                       album: "Traveling Wilburys Vol. 1 (1988)", itunesQuery: "Dirty World Traveling Wilburys" },
  { title: "Rattled",                           album: "Traveling Wilburys Vol. 1 (1988)", itunesQuery: "Rattled Traveling Wilburys" },
  { title: "Last Night",                        album: "Traveling Wilburys Vol. 1 (1988)", itunesQuery: "Last Night Traveling Wilburys" },
  { title: "Not Alone Any More",                album: "Traveling Wilburys Vol. 1 (1988)", itunesQuery: "Not Alone Any More Traveling Wilburys" },
  { title: "Congratulations",                   album: "Traveling Wilburys Vol. 1 (1988)", itunesQuery: "Congratulations Traveling Wilburys" },
  { title: "Heading for the Light",             album: "Traveling Wilburys Vol. 1 (1988)", itunesQuery: "Heading for the Light Traveling Wilburys" },
  { title: "Margarita",                         album: "Traveling Wilburys Vol. 1 (1988)", itunesQuery: "Margarita Traveling Wilburys" },
  { title: "Tweeter and the Monkey Man",        album: "Traveling Wilburys Vol. 1 (1988)", itunesQuery: "Tweeter and the Monkey Man Traveling Wilburys" },
  { title: "End of the Line",                   album: "Traveling Wilburys Vol. 1 (1988)", itunesQuery: "End of the Line Traveling Wilburys" },
  { title: "She's My Baby",                     album: "Traveling Wilburys Vol. 3 (1990)", itunesQuery: "She's My Baby Traveling Wilburys" },
  { title: "Inside Out",                        album: "Traveling Wilburys Vol. 3 (1990)", itunesQuery: "Inside Out Traveling Wilburys" },
  { title: "If You Belonged to Me",             album: "Traveling Wilburys Vol. 3 (1990)", itunesQuery: "If You Belonged to Me Traveling Wilburys" },
  { title: "The Devil's Been Busy",             album: "Traveling Wilburys Vol. 3 (1990)", itunesQuery: "The Devil's Been Busy Traveling Wilburys" },
  { title: "7 Deadly Sins",                     album: "Traveling Wilburys Vol. 3 (1990)", itunesQuery: "7 Deadly Sins Traveling Wilburys" },
  { title: "Poor House",                        album: "Traveling Wilburys Vol. 3 (1990)", itunesQuery: "Poor House Traveling Wilburys" },
  { title: "Where Were You Last Night?",        album: "Traveling Wilburys Vol. 3 (1990)", itunesQuery: "Where Were You Last Night Traveling Wilburys" },
  { title: "Cool Dry Place",                    album: "Traveling Wilburys Vol. 3 (1990)", itunesQuery: "Cool Dry Place Traveling Wilburys" },
  { title: "New Blue Moon",                     album: "Traveling Wilburys Vol. 3 (1990)", itunesQuery: "New Blue Moon Traveling Wilburys" },
  { title: "You Took My Breath Away",           album: "Traveling Wilburys Vol. 3 (1990)", itunesQuery: "You Took My Breath Away Traveling Wilburys" },
  { title: "Wilbury Twist",                     album: "Traveling Wilburys Vol. 3 (1990)", itunesQuery: "Wilbury Twist Traveling Wilburys" },
];

// All song titles for autocomplete
const ALL_TITLES = SONGS.map(s => s.title);

// Clip durations per guess (seconds)
const CLIP_DURATIONS = [1, 2, 4, 7, 11];
const MAX_GUESSES = 5;

// â”€â”€â”€ STATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let score = 0;
let roundCount = 0;
let guessCount = 0;
let guesses = [];
let gameOver = false;
let isPlaying = false;
let waveformInterval = null;
let songQueue = [];  // endless shuffled queue

function currentSong() {
  return songQueue[0];
}

function advanceQueue() {
  songQueue.shift();
  if (songQueue.length === 0) {
    // Reshuffle entire catalog when exhausted
    songQueue = [...SONGS].sort(() => Math.random() - 0.5);
  }
}

// â”€â”€â”€ INIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function init() {
  songQueue = [...SONGS].sort(() => Math.random() - 0.5);
  roundCount = 0;
  score = 0;
  updateScoreDisplay();
  startRound();
}
function startRound() {
  guessCount = 0;
  guesses = [];
  gameOver = false;

  updateScoreDisplay();
  renderLives();
  renderGuessSlots();
  updateRoundLabel();
  updatePlayBtn();
  resetWaveform();

  document.getElementById('song-input').value = '';
  document.getElementById('song-input').disabled = false;
  document.getElementById('guess-btn').disabled = false;
  document.getElementById('skip-btn').disabled = false;
  document.getElementById('result-overlay').classList.remove('show');
  document.getElementById('player-card').style.display = '';
  document.getElementById('suggestions').style.display = 'none';

  const artEl = document.getElementById('album-art');
  if (artEl) { artEl.style.display = 'none'; artEl.classList.remove('loaded'); }

  loadAudio(currentSong());
}

// â”€â”€â”€ AUDIO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// iTunes Search API doesn't allow direct browser fetch (CORS) or JSONP.
// We route the search through allorigins.win, a free CORS proxy.
// The preview MP3 itself is played via an <audio> element (media bypasses CORS).

let audioEl = null; // single reusable <audio> element
let clipTimer = null;

async function itunesSearch(query) {
  const itunesUrl = `https://itunes.apple.com/search?term=${encodeURIComponent(query)}&entity=song&limit=8&country=us`;
  const proxies = [
    () => fetch(`https://corsproxy.io/?${encodeURIComponent(itunesUrl)}`),
    () => fetch(`https://api.codetabs.com/v1/proxy?quest=${encodeURIComponent(itunesUrl)}`),
    () => fetch(`https://thingproxy.freeboard.io/fetch/${itunesUrl}`),
  ];
  for (const proxyFn of proxies) {
    try {
      const resp = await proxyFn();
      if (!resp.ok) continue;
      const data = await resp.json();
      if (data && data.results !== undefined) return data;
      if (data && data.contents) return JSON.parse(data.contents);
    } catch(e) {
      // try next proxy
    }
  }
  throw new Error('All proxies failed');
}

async function loadAudio(song) {
  setPlayBtnLoading(true);

  // Stop & detach any previous audio immediately
  if (audioEl) {
    audioEl.pause();
    audioEl.oncanplaythrough = null;
    audioEl.onerror = null;
    audioEl.src = '';
  }

  // Tag this load so stale responses from previous rounds are ignored
  const loadId = Date.now();
  song._loadId = loadId;

  try {
    const data = await itunesSearch(song.itunesQuery);

    // If a new round started while we were fetching, bail out
    if (currentSong()._loadId !== loadId) return;

    const results = data.results || [];
    let track = results.find(r =>
      r.previewUrl && r.artistName && r.artistName.toLowerCase().includes('beatles')
    );
    if (!track) track = results.find(r => r.previewUrl);
    if (!track) throw new Error('No preview found for: ' + song.title);

    song.previewUrl = track.previewUrl;
    song.artworkUrl = (track.artworkUrl100 || '').replace('100x100bb', '300x300bb');

    // Album art fade-in
    const artEl = document.getElementById('album-art');
    if (song.artworkUrl && artEl) {
      artEl.onload = () => artEl.classList.add('loaded');
      artEl.src = song.artworkUrl;
      artEl.style.display = 'block';
    }

    // Create a fresh Audio element each round â€” avoids stale state issues
    audioEl = new Audio();
    audioEl.preload = 'auto';

    // Wait for enough audio to be buffered before enabling play
    await new Promise((resolve, reject) => {
      audioEl.oncanplaythrough = resolve;
      audioEl.onerror = () => reject(new Error('Audio element error'));
      audioEl.src = song.previewUrl;
      audioEl.load();
      // Fallback: enable after 4s even if canplaythrough hasn't fired
      setTimeout(resolve, 4000);
    });

    // Only update UI if we're still on the same round
    if (currentSong()._loadId === loadId) {
      setPlayBtnLoading(false);
    }

  } catch(e) {
    console.warn('Audio load error:', e);
    if (currentSong()._loadId === loadId) {
      document.getElementById('play-btn-text').textContent = 'Preview unavailable';
      document.getElementById('play-btn').disabled = true;
    }
  }
}

function setPlayBtnLoading(loading) {
  const btn = document.getElementById('play-btn');
  const txt = document.getElementById('play-btn-text');
  if (loading) {
    txt.textContent = 'Loading previewâ€¦';
    btn.disabled = true;
  } else if (!isPlaying) {
    txt.textContent = 'Play Clip';
    btn.disabled = false;
  }
}

function playClip() {
  if (isPlaying || !audioEl || !audioEl.src) return;

  const duration = CLIP_DURATIONS[guessCount] || CLIP_DURATIONS[CLIP_DURATIONS.length - 1];

  audioEl.currentTime = 0;
  audioEl.play().catch(e => console.warn('Playback error:', e));

  isPlaying = true;
  animateWaveform(duration);
  updatePlayBtn();

  // Stop after clip duration
  clearTimeout(clipTimer);
  clipTimer = setTimeout(() => {
    audioEl.pause();
    isPlaying = false;
    stopWaveformAnimation();
    updatePlayBtn();
  }, duration * 1000);
}

// â”€â”€â”€ WAVEFORM â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const NUM_BARS = 48;

function resetWaveform() {
  const wf = document.getElementById('waveform');
  wf.innerHTML = '';
  for (let i = 0; i < NUM_BARS; i++) {
    const bar = document.createElement('div');
    bar.className = 'bar unplayed';
    bar.style.height = (Math.random() * 36 + 10) + 'px';
    wf.appendChild(bar);
  }
}

function animateWaveform(duration) {
  const bars = document.querySelectorAll('.bar');
  const totalMs = duration * 1000;
  const startTime = Date.now();

  clearInterval(waveformInterval);
  waveformInterval = setInterval(() => {
    const elapsed = Date.now() - startTime;
    const progress = Math.min(elapsed / totalMs, 1);
    const playedBars = Math.floor(progress * NUM_BARS);

    bars.forEach((bar, i) => {
      if (i < playedBars) {
        bar.className = 'bar played';
      } else if (i === playedBars) {
        bar.className = 'bar playing';
      } else {
        bar.className = 'bar unplayed';
      }
      // slight random height flicker on playing bar
      if (i === playedBars) {
        bar.style.height = (Math.random() * 40 + 15) + 'px';
      }
    });

    const timeEl = document.getElementById('time-display');
    timeEl.textContent = (elapsed / 1000).toFixed(1) + 's';

    if (progress >= 1) {
      clearInterval(waveformInterval);
      bars.forEach(b => { b.classList.remove('playing'); });
    }
  }, 50);
}

function stopWaveformAnimation() {
  clearInterval(waveformInterval);
  document.querySelectorAll('.bar.playing').forEach(b => b.classList.remove('playing'));
}

// â”€â”€â”€ UI UPDATES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderLives() {
  const el = document.getElementById('lives');
  el.innerHTML = '';
  for (let i = 0; i < MAX_GUESSES; i++) {
    const d = document.createElement('div');
    d.className = 'life' + (i >= (MAX_GUESSES - guessCount) ? ' used' : '');
    el.appendChild(d);
  }
}

function renderGuessSlots() {
  const el = document.getElementById('guess-slots');
  el.innerHTML = '';
  for (let i = 0; i < MAX_GUESSES; i++) {
    const slot = document.createElement('div');
    const guess = guesses[i];
    if (!guess) {
      slot.className = 'guess-slot empty' + (i === guessCount && !gameOver ? ' active' : '');
      slot.textContent = i === guessCount && !gameOver ? 'Your guessâ€¦' : '';
    } else if (guess.skipped) {
      slot.className = 'guess-slot skipped';
      slot.innerHTML = '<span class="icon">â¤­</span> Skipped (+' + CLIP_DURATIONS[Math.min(i+1, CLIP_DURATIONS.length-1)] + 's unlocked)';
    } else if (guess.correct) {
      slot.className = 'guess-slot correct';
      slot.innerHTML = '<span class="icon">âœ“</span>' + guess.text;
    } else {
      slot.className = 'guess-slot wrong';
      slot.innerHTML = '<span class="icon">âœ—</span>' + guess.text;
    }
    el.appendChild(slot);
  }
}

function updateRoundLabel() {
  const duration = CLIP_DURATIONS[guessCount] || CLIP_DURATIONS[CLIP_DURATIONS.length - 1];
  document.getElementById('round-label').textContent =
    `GUESS ${guessCount + 1} OF ${MAX_GUESSES} â€” ${duration}S CLIP`;
  document.getElementById('reveal-label').textContent = `â–¶ ${duration} second${duration !== 1 ? 's' : ''}`;
}

function updatePlayBtn() {
  const btn = document.getElementById('play-btn');
  const txt = document.getElementById('play-btn-text');
  if (isPlaying) {
    txt.textContent = 'Playingâ€¦';
    btn.disabled = true;
  } else {
    txt.textContent = 'Play Clip';
    btn.disabled = false;
  }
}

function updateScoreDisplay() {
  document.getElementById('score').textContent = score;
  document.getElementById('round-num').textContent = roundCount + 1;
}

// â”€â”€â”€ GUESSING â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function submitGuess(text) {
  if (gameOver) return;
  const input = text || document.getElementById('song-input').value.trim();
  if (!input) return;

  const correct = input.toLowerCase() === currentSong().title.toLowerCase();
  guesses.push({ text: input, correct, skipped: false });
  guessCount++;

  document.getElementById('song-input').value = '';
  document.getElementById('suggestions').style.display = 'none';

  renderLives();
  renderGuessSlots();

  if (correct) {
    endRound(true);
  } else if (guessCount >= MAX_GUESSES) {
    endRound(false);
  } else {
    updateRoundLabel();
  }
}

function skipGuess() {
  if (gameOver) return;
  guesses.push({ text: '', skipped: true, correct: false });
  guessCount++;
  document.getElementById('song-input').value = '';
  document.getElementById('suggestions').style.display = 'none';
  renderLives();
  renderGuessSlots();
  if (guessCount >= MAX_GUESSES) {
    endRound(false);
  } else {
    updateRoundLabel();
  }
}

function endRound(won) {
  gameOver = true;
  if (audioEl) { audioEl.pause(); }
  clearTimeout(clipTimer);
  stopWaveformAnimation();
  isPlaying = false;

  document.getElementById('song-input').disabled = true;
  document.getElementById('guess-btn').disabled = true;
  document.getElementById('skip-btn').disabled = true;

  const song = currentSong();
  const overlay = document.getElementById('result-overlay');

  if (won) {
    const pointsEarned = MAX_GUESSES - guessCount + 1;
    score += pointsEarned;
    document.getElementById('result-emoji').textContent = guessCount === 1 ? 'ðŸŽ¸' : guessCount <= 2 ? 'ðŸŽ¶' : 'ðŸŽµ';
    document.getElementById('result-title').textContent = guessCount === 1 ? 'First Try! Brilliant!' : `Got it in ${guessCount} guess${guessCount !== 1 ? 'es' : ''}!`;
  } else {
    document.getElementById('result-emoji').textContent = 'ðŸ˜¢';
    document.getElementById('result-title').textContent = 'Better luck next time!';
  }

  document.getElementById('result-song').textContent = `"${song.title}"`;
  document.getElementById('result-album').textContent = song.album;
  updateScoreDisplay();

  overlay.classList.add('show');
  document.getElementById('next-btn').textContent = 'Next Song â†’';
}

function nextRound() {
  advanceQueue();
  roundCount++;
  startRound();
}


// â”€â”€â”€ AUTOCOMPLETE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let highlightIndex = -1;

document.getElementById('song-input').addEventListener('input', function() {
  const val = this.value.trim().toLowerCase();
  const sug = document.getElementById('suggestions');
  if (!val) { sug.style.display = 'none'; return; }

  const matches = ALL_TITLES.filter(t => t.toLowerCase().includes(val));
  if (!matches.length) { sug.style.display = 'none'; return; }

  sug.innerHTML = '';
  highlightIndex = -1;
  matches.slice(0, 8).forEach((m, i) => {
    const item = document.createElement('div');
    item.className = 'suggestion-item';
    item.textContent = m;
    item.addEventListener('mousedown', (e) => {
      e.preventDefault();
      document.getElementById('song-input').value = m;
      sug.style.display = 'none';
    });
    sug.appendChild(item);
  });
  sug.style.display = 'block';
});

document.getElementById('song-input').addEventListener('keydown', function(e) {
  const sug = document.getElementById('suggestions');
  const items = sug.querySelectorAll('.suggestion-item');

  if (e.key === 'ArrowDown') {
    e.preventDefault();
    highlightIndex = Math.min(highlightIndex + 1, items.length - 1);
    items.forEach((it, i) => it.classList.toggle('highlighted', i === highlightIndex));
    if (items[highlightIndex]) this.value = items[highlightIndex].textContent;
  } else if (e.key === 'ArrowUp') {
    e.preventDefault();
    highlightIndex = Math.max(highlightIndex - 1, -1);
    items.forEach((it, i) => it.classList.toggle('highlighted', i === highlightIndex));
    if (highlightIndex >= 0 && items[highlightIndex]) this.value = items[highlightIndex].textContent;
  } else if (e.key === 'Enter') {
    e.preventDefault();
    sug.style.display = 'none';
    submitGuess();
  } else if (e.key === 'Escape') {
    sug.style.display = 'none';
  }
});

document.getElementById('song-input').addEventListener('blur', () => {
  setTimeout(() => { document.getElementById('suggestions').style.display = 'none'; }, 150);
});

// â”€â”€â”€ EVENTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
document.getElementById('play-btn').addEventListener('click', playClip);
document.getElementById('guess-btn').addEventListener('click', () => submitGuess());
document.getElementById('skip-btn').addEventListener('click', skipGuess);
document.getElementById('next-btn').addEventListener('click', nextRound);

// â”€â”€â”€ START â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
init();
</script>
</body>
</html>
